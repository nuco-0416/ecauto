# 経営管理データ集計プロジェクト (Finance Manager)

本プロジェクトは、複数事業の収益構造を正確に把握し、グロース戦略を策定するための管理会計システムです。

## 🏷️ 事業区分（セグメント定義）

### なぜ「無在庫」と「有在庫」を分けるのか？
ビジネスモデル（収益構造）と管理すべきKPIが全く異なるため、明確に区別します。

* **無在庫EC (EC_Drop):** オペレーション勝負。利益率は低いが在庫リスクなし。KPIは「作業効率」と「出品数」。
* **有在庫EC (EC_Stock):** 商品力勝負。在庫リスクがあり、資金拘束（キャッシュフロー）が重要。KPIは「在庫回転率」と「原価率」。

### 定義済みセグメントID (Project ID)
スクリプト内での集計キーとして使用します。

| ID | 事業名 / 備考 | 含まれるプラットフォーム・アカウント |
| :--- | :--- | :--- |
| **1_D2C_Hadient** | D2Cシャンプー事業 | EC-hadient (Subsc, Amazon) |
| **2_List_Supple** | リスト販売 (サプリ) | btc |
| **3_List_Men** | リスト販売 (精力剤) | pap, BASE(sanyodo) |
| **4_Agency** | 代理店事業 | ASP報酬など |
| **5_EC_Drop** | **無在庫EC** | BASE, Mercari Shops, Yahoo, eBay, Shopee |
| **6_EC_Stock** | **有在庫EC** | Amazon (OEM/仕入れ) |
| **Common** | 全社共通費 | 本社家賃, 役員報酬, バックオフィス人件費など |

---

## 📁 ファイル運用ルール

### 1. 命名規則
`01_raw_data` フォルダへの保存時、以下のルールでリネームしてください。

* **確定した過去月 (保存版)**
    * 形式: `YYYYMM_ソース名_詳細.csv`
    * 例: `202511_Stripe_Hadient.csv`
* **進行中の今月分 (一時ファイル)**
    * 形式: `YYYYMM_ソース名_詳細_latest.csv`
    * 例: `202512_Stripe_Hadient_latest.csv`
    * ※更新時は同じ名前で上書き保存する

---

## ⚠️ データソース別・要注意リスト (Known Issues)

### D2C (Hadient) / Shopify
* **取得場所:** Shopify管理画面 > 注文管理 > エクスポート
* **データ形式:** 明細行形式（行が増えるタイプ）。
* **重複あり:** セット商品などの場合、同一注文番号が複数行に出力される。`注文番号`でユニーク化が必要。
* **キャンセル:** `キャンセル日` カラムに日付が入っている行は除外処理が必要。
* **注意点:** 件数が多いとブラウザDLではなくメールで送られてくる。

### Amazon
* **取得場所:** セラーセントラル > ペイメント > 期間指定レポート
* **レポート種類:** **「トランザクション (Transaction)」** を選択すること。
    * ※「概要」や「決済レポート」はNG（期間ズレや詳細不足のため）。
* **データ形式:** トランザクション形式。日本語ヘッダー。
* **ロジック:**
    * 売上 = `商品価格合計`
    * 変動費 = `Amazon手数料`

### eBay (Export)
* **取得場所:** Seller Hub > Payments > Reports > Transaction report
* **データ形式:** トランザクション形式（家計簿のような縦積み）。
* **注意点:**
    * 1つの注文が「売上行」「手数料行」「配送料行」にバラバラに分かれて出力される。
    * 集計時は `Transaction type` 列で「Order」や「Refund」を判別する必要あり。
    * USDではなく「Payout amount」などの円換算された列を使用すること。

### BASE
* **取得場所:** 注文管理 > CSVダウンロード
* **データ形式:** 明細行形式。
* **注意点:**
    * `送料` や `代引き手数料` は注文単位のデータだが、商品行ごとに同じ値が入って繰り返される。
    * 単純合計すると送料が倍増するため、`注文ID` で重複排除して計算する必要あり。
    * **特例:** `sanyodo` アカウントは `3_List_Men` 事業として集計する。

### Mercari Shops
* **データ形式:** 明細行形式。英語ヘッダー。
* **項目名:** `product_price`, `shipping_price` 等。
* **注意点:** 注文ID (`order_id`) をキーに管理する。