# Guidelines

This document defines the project's rules, objectives, and progress management methods. Please proceed with the project according to the following content.

## Top-Level Rules

- このプロンプトは ecauto プロジェクト（C:\Users\hiroo\Documents\GitHub\ecauto）についてのルールを規定しています。
- 本プロジェクトは完全なスタンドアロンであることが前提です。レガシーの実装への参照・依存が発生しないように進めてください。
- タイムゾーンについて：実行環境はJSTを想定しています。明示的にJSTと異なるタイムゾーンでの実行が想定されていない限り時間帯関連の処理、実装を進める場合にはJSTを指定してください。

### 仕様、作業履歴について
- 仕様についての確認やエラー原因の分析、実装に関する矛盾の確認などについてはドキュメントディレクトリを参照してください。
- 仕様、作業履歴などについてのドキュメントは　C:\Users\hiroo\Documents\GitHub\ecauto\docs　に保存されています。

## Programming Rules

- 【重要！】API名、メソッド名、変数名などを記述するときは必ず確実な根拠となるドキュメントやデータベース、ソースコードを参照してください。元になる変数やメソッドが見つからない場合は絶対に推測でコードを記述しないこと。その場合には中断してユーザーに報告してください。
- **Python実行の標準形**：必ず以下の形式でPowerShell経由で実行すること
  ```
  powershell -Command "& 'C:\Users\hiroo\Documents\GitHub\ecauto\venv\Scripts\python.exe' スクリプトパス [オプション]"
  ```
  - 出力制限が必要な場合：`2>&1 | Select-Object -Last 50` を末尾に追加
  - この形式以外（python直接実行、相対パス等）は使用禁止
- テスト用スクリプトを作成する場合には処理の完了後に削除してください（プロジェクトディレクトリの保守のため）
- 既存コードに変更を加える場合には必ずバックアップを用意して意図しない不具合が起こった場合に巻き戻しができる状態で作業してください。
- 価格設定や在庫管理に関しての仕様の独断での変更は絶対にNGです。実装上で矛盾や問題が発生した場合にはユーザーに確認をしてください。
- コードの実装後は、基本的な動作確認テストを行うまでを1ループとしてください。
- 既存の処理系を再実装してリポジトリが混乱することを避けてください。新規実装を進めようとしているコードが既に存在しないかを確認し、存在しない場合のみ新規コードを作成してください。
- テスト用の作成したスクリプトファイルは都度削除してリポジトリをクリーンに保ってください。

## Testing Rules

### テストの基本方針

**【最重要】本番スクリプトを直接テストする**
- 新機能の実装やバグ修正後は、必ず本番スクリプトを直接実行してテストすること
- テスト専用スクリプトを作成すると、本番との実装の違いによりバグを見逃す可能性がある
- 実際の使用方法（main関数、コマンドラインオプションなど）と同じ条件でテストすること

### テストの優先順位

1. **第一優先：本番スクリプトでの直接テスト**
   - コマンドラインオプション（--dry-run, --max-items など）を活用して少数データでテスト
   - 実際の使用方法と完全に同じ条件でテストする
   - 例：`venv\Scripts\python.exe platforms\base\scripts\sync_prices.py --dry-run --max-items 20 --account base_account_1`

2. **補助的：テストスクリプトの作成**
   - 複雑なロジックの単体テストが必要な場合のみ作成
   - 作成する場合でも、本番と同じ使用方法（戻り値の取得、エラーハンドリングなど）でテストすること
   - テスト完了後は必ず削除すること

3. **必須：テスト後の確認事項**
   - 戻り値が正しく返されているか
   - エラーハンドリングが正しく機能しているか
   - ログ出力が期待通りか
   - 統計情報が正しく記録されているか

### テスト時の注意事項

- **DRY RUNモードを活用**：実際のデータを変更せずにテストできる
- **少数データでテスト**：--max-items オプションなどで処理件数を制限
- **ログレベルの確認**：必要に応じてlogging.basicConfig()でDEBUGレベルに設定
- **並列処理の無効化**：デバッグ時は --no-parallel オプションで逐次処理に切り替え

### Claude環境でのテスト

- Claude環境でテストを実施する場合も、本番スクリプトを直接実行すること
- テスト用スクリプトを作成した場合は、必ず完了後に削除すること
- ユーザー環境での実行結果と同じ条件でテストすること