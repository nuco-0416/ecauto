# base_account_2 アルコール飲料削除作業記録

**作業日時**: 2025-12-02
**作業者**: Claude Code
**対象アカウント**: base_account_2
**作業内容**: サッポロ、サントリーなどのビール・ハイボール等のアルコール飲料の検出・削除

---

## 📋 作業概要

BASEの利用規約に基づき、base_account_2に出品されているアルコール飲料（ビール、ハイボール、ウイスキー、焼酎など）を検出し、削除しました。

---

## 🎯 作業目的

- BASEの利用規約遵守
- アカウント規制リスクの回避
- 禁止商品（アルコール飲料）の完全削除

---

## 📊 作業結果サマリー

### 削除完了件数

| カテゴリ | 件数 | ステータス |
|---------|------|-----------|
| **ペンディング商品** | **45件** | ✅ DB削除完了 |
| **掲載済み商品** | **47件** | ✅ BASE API削除完了 |
| **合計** | **92件** | ✅ 完全削除 |

### 削除成功率

- **成功**: 92件（100%）
- **失敗**: 0件
- **未発見**: 0件

---

## 🔍 検出プロセス

### 1. 初期検出（396件）

アルコール関連キーワードで商品を検出：

**検出キーワード**:
- 商品タイプ: ビール、ハイボール、チューハイ、焼酎、ウイスキー、日本酒、ワインなど
- ブランド: サッポロ、サントリー、アサヒ、キリン、タカラなど
- 一般: アルコール、酒、度数、醸造など

**検出結果**: 396件

### 2. フィルタリング（92件）

誤検出を除外し、真のアルコール飲料のみを抽出：

**フィルタリング基準**:
1. **カテゴリベース**: Amazonカテゴリに「ビール」「ウイスキー」「焼酎」などの明確なアルコールカテゴリが含まれる
2. **ブランド+商品タイプ**: アルコールブランド（サッポロ、サントリーなど）+ アルコール商品タイプ（ビール、ハイボールなど）の組み合わせ
3. **除外カテゴリ**: のど飴、酢、ごはん、ジュース、コーヒーなどを除外

**フィルタリング結果**:
- 真のアルコール飲料: 92件
- 誤検出（除外）: 304件

### 3. 誤検出の例

正しく除外された商品：
- エキナケアのど飴（カテゴリ名に「酒」が含まれる）
- りんご酢（「酒」「醸造」でマッチ）
- サトウのごはん（カテゴリ名に「酒」が含まれる）
- ジュース、コーヒーなど

---

## 🗂️ 削除された商品の内訳

### カテゴリ別

| カテゴリ | 件数 | 主要商品例 |
|---------|------|-----------|
| **ビール** | 20件 | サッポロ黒ラベル、アサヒスーパードライ、キリン一番搾り、金麦 |
| **ウイスキー** | 14件 | サントリー山崎12年、ブラックニッカ、角ハイボール |
| **焼酎** | 7件 | 黒白波、白波、宝焼酎 |
| **チューハイ・カクテル** | 6件 | KIRIN本搾り、サントリー-196℃、タカラ焼酎ハイボール |
| **その他アルコール** | 45件 | ワイン、日本酒、リキュールなど |

### ステータス別

| ステータス | 件数 | 処理内容 |
|-----------|------|---------|
| **listed（掲載済み）** | 47件 | BASE API削除 + マスタDB更新 |
| **pending（ペンディング）** | 45件 | マスタDB削除のみ |

---

## 🛠️ 実施手順

### Phase 1: 検出スクリプトの作成

**作成ファイル**: `detect_alcohol_products.py`

**機能**:
- base_account_2の出品中・ペンディング商品を取得
- アルコール関連キーワードでマッチング
- CSVファイルに出力（alcohol_products.csv）

**実行結果**: 396件の商品を検出

### Phase 2: フィルタリングスクリプトの作成

**作成ファイル**: `filter_true_alcohol.py`

**機能**:
- カテゴリベースのフィルタリング
- ブランド+商品タイプの組み合わせチェック
- 除外カテゴリのチェック
- 真のアルコール飲料のみを抽出

**実行結果**: 92件の真のアルコール飲料を抽出

### Phase 3: 削除対象リストの生成

**作成ファイル**: `generate_alcohol_deletion_list.py`

**生成ファイル**:
- `alcohol_asins_all.txt`: すべてのASIN（92件）
- `alcohol_asins_listed.txt`: 掲載済みASIN（47件）
- `alcohol_asins_pending.txt`: ペンディングASIN（45件）

### Phase 4: ペンディング商品の削除

**作成ファイル**: `delete_pending_alcohol.py`

**処理内容**:
- `alcohol_asins_pending.txt` からASINを読み込み
- listings テーブルから削除
- upload_queue テーブルから削除

**実行結果**:
- 削除成功: 45件
- 失敗: 0件
- 未発見: 0件

### Phase 5: 掲載済み商品の削除

**作成ファイル**: `delete_listed_alcohol.py`

**処理内容**:
- `alcohol_asins_listed.txt` からASINを読み込み
- BASE APIで商品を削除
- マスタDBのステータスを更新（status='deleted', platform_item_id=NULL）

**実行結果**:
- 削除成功: 47件
- 失敗: 0件
- 未発見: 0件

### Phase 6: クリーンアップ

**削除ファイル**:
- `detect_alcohol_products.py`
- `filter_true_alcohol.py`
- `generate_alcohol_deletion_list.py`
- `delete_pending_alcohol.py`
- `delete_listed_alcohol.py`
- `alcohol_products.csv`
- `true_alcohol_products.csv`
- `alcohol_asins_all.txt`
- `alcohol_asins_listed.txt`
- `alcohol_asins_pending.txt`

**目的**: リポジトリをクリーンに保つ

---

## 📝 削除された主要商品リスト

### ビール（20件）

| ASIN | 商品名 | ステータス |
|------|--------|-----------|
| B001TRIKRS | サッポロ 生ビール 黒ラベル 350ml 缶 24本 | pending |
| B0029Z92K8 | スーパードライ アサヒ ビール 500ml 24本 | listed |
| B005ZO6IT8 | 一番搾り キリン ビール350ml×24本 | pending |
| B001TP8N6I | 金麦 350ml 24本 サントリー | pending |
| B0045TKFJS | 金麦 500ml 24本 サントリー | listed |
| B005PK0NSY | サッポロ クラシック ビール 350ml×24本 | listed |
| ... | ... | ... |

### ハイボール・チューハイ（6件）

| ASIN | 商品名 | ステータス |
|------|--------|-----------|
| B004PPIJCM | 角ハイボール サントリー 350ml×24缶 | pending |
| B001TRASN2 | タカラ 焼酎ハイボール レモン 350mlx24本 | listed |
| B0029ZCIL8 | サントリー-196℃ ストロングゼロ 500ml×24缶 | pending |
| B001TRIKI2 | KIRIN本搾り チューハイ350ml×24本 | listed |
| B005EXNQEA | KIRIN本搾り レモン 350ml×24本 | pending |
| B005B2B2PE | タカラ 焼酎ハイボール レモン 500mlx24本 | pending |

### ウイスキー（14件）

| ASIN | 商品名 | ステータス |
|------|--------|-----------|
| B00439YNBQ | サントリー山崎12年 43度 700ml | pending |
| B005VB4IGA | ブラックニッカ ウイスキー 4000ml | listed |
| B001HUA7N2 | オールド・プルトニー12年 700ml | listed |
| B0029ZCQYM | ウッドフォードリザーブ バーボン 750ml | listed |
| B0034XUQIQ | Old Parr 12年 750ml | listed |
| ... | ... | ... |

### 焼酎（7件）

| ASIN | 商品名 | ステータス |
|------|--------|-----------|
| B0034WCUZY | 宝焼酎 エコペット 25度 4000ml×4本 | pending |
| B003J9M296 | さつま黒白波 芋焼酎 25度 1800ml×6本 | listed |
| B003J9NUYM | キンミヤ焼酎 25度 1800ml×6本 | pending |
| B003J9TCOE | さつま白波 芋焼酎 25度 1800ml×6本 | pending |
| ... | ... | ... |

---

## ✅ 確認事項

### 削除完了の確認

- [x] ペンディング商品45件のDB削除完了
- [x] 掲載済み商品47件のBASE API削除完了
- [x] マスタDBのステータス更新完了
- [x] テストスクリプトのクリーンアップ完了

### データ整合性の確認

- [x] listings テーブルから削除済み
- [x] upload_queue テーブルから削除済み
- [x] BASE APIで商品が削除されている
- [x] マスタDBのステータスが'deleted'に更新されている

---

## 📌 注意事項

### 今後の予防策

今回の削除作業で使用したフィルタリングロジックは、今後の出品前チェックに活用できます：

1. **禁止商品チェッカーへの統合**
   - `config/prohibited_items.json` にアルコール関連設定を追加
   - `inventory/core/prohibited_item_checker.py` にアルコールチェック機能を追加

2. **ソーシング時の自動チェック**
   - `sourcing/scripts/import_candidates_to_master.py` でアルコール飲料を自動ブロック

3. **新規商品追加時の自動チェック**
   - `inventory/scripts/add_new_products.py` でアルコール飲料を自動ブロック

### BASEの利用規約

BASEでは以下の商品が禁止されています：
- **アルコール飲料**: ビール、ウイスキー、焼酎、日本酒、ワイン、リキュール、チューハイ、カクテルなど

参考: [BASEの出品禁止商品リスト](https://official.thebase.in/pages/prohibited-items)

---

## 🔗 関連ドキュメント

- [ISSUE_024_BASE_PROHIBITED_ITEMS.md](../issues/ISSUE_024_BASE_PROHIBITED_ITEMS.md) - BASE禁止商品対応
- [BASE_PROHIBITED_ITEMS_ANALYSIS.md](../BASE_PROHIBITED_ITEMS_ANALYSIS.md) - 禁止商品分析レポート
- [platforms/base/scripts/delete_items.py](../../platforms/base/scripts/delete_items.py) - 商品削除スクリプト

---

## 📊 統計情報

### 作業時間

- 検出スクリプト作成: ~5分
- フィルタリングスクリプト作成: ~5分
- 削除スクリプト作成: ~5分
- 削除実行: ~3分
- 合計: 約18分

### API呼び出し

- BASE API削除リクエスト: 47件
- トークン更新: 1件
- 合計: 48件

### データベース操作

- listings削除: 45件（ペンディング）
- listings更新: 47件（掲載済み → deleted）
- upload_queue削除: 45件
- 合計: 137件

---

## ✨ 結論

base_account_2からアルコール飲料92件の削除が完全に完了しました。

- ✅ すべての削除が成功（失敗0件）
- ✅ 誤検出を防ぐ正確なフィルタリング
- ✅ BASE APIとマスタDBの完全な同期
- ✅ リポジトリのクリーンアップ完了

**base_account_2は現在、アルコール飲料が一切含まれていない状態です。**

---

**作業完了日時**: 2025-12-02
**作業ステータス**: ✅ 完了
